"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("lodash"),u=require("typedi"),l=require("react");function y(n,t,e,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,t,e,s);else for(var h=n.length-1;h>=0;h--)(c=n[h])&&(i=(r<3?c(i):r>3?c(t,e,i):c(t,e))||i);return r>3&&i&&Object.defineProperty(t,e,i),i}function w(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function p(n,t,e,s){function r(i){return i instanceof e?i:new e(function(c){c(i)})}return new(e||(e=Promise))(function(i,c){function h(o){try{d(s.next(o))}catch(f){c(f)}}function b(o){try{d(s.throw(o))}catch(f){c(f)}}function d(o){o.done?i(o.value):r(o.value).then(h,b)}d((s=s.apply(n,t||[])).next())})}let m=class{constructor(){this._actions=void 0,this._state=void 0,this._defaultContext={state:this._state,dispatch:()=>({})},this._isInit=!1,this._middlewares=[],this.context=l.createContext(this._defaultContext),this.storeReducer=(t,e)=>(this._state=a.cloneDeep(t),this.onTry(()=>this._actions[e.type.split("/")[0]][e.type](e.payload)),this._state),this.storeProvider=({children:t})=>{const[e,s]=this.useReducerWithMiddleware(),r=l.useMemo(()=>({state:e,dispatch:s}),[e,s]);return l.createElement(this.context.Provider,{value:Object.seal(r),children:t})}}init(t,e){if(this._isInit===!1)return this._isInit=!0,this._actions=e,this._state=a.cloneDeep(t),Object.assign(Object.assign({},this.store),{storeInstance:this})}onTry(t){try{t()}catch(e){console.log(e)}}useReducerWithMiddleware(){const[t,e]=l.useReducer(this.storeReducer,this._state),s=r=>p(this,void 0,void 0,function*(){yield Promise.allSettled(this._middlewares.map(i=>i.action.call(this,{action:r,state:this.proxyState,actions:this.filterAction,dispatch:e})).concat((()=>p(this,void 0,void 0,function*(){return e(r)})).call(this)))});return[this._state,s]}useStore(t){const{dispatch:e}=l.useContext(this.context);return t?[t(this._state),{dispatch:e,actions:this.filterAction}]:[this._state,{dispatch:e,actions:this.filterAction}]}get proxyState(){return new Proxy(Object.seal(this._state),{})}get store(){return{useStore:this.useStore.bind(this),StoreProvider:Object.defineProperty(this.storeProvider,"name",{value:"StoreProvider"})}}getState(){return this._state}setState(t){this._state=a.cloneDeep(Object.assign(Object.assign({},this._state),t))}setMiddleware(...t){return this._middlewares=this._middlewares.concat(t)}createMiddleware(...t){return this.setMiddleware(...t.map(e=>({action:e})))}checkSliceName(t){if(this._state)return t in this._state}get filterAction(){const t=a.cloneDeep(this._actions);for(const e in t)for(const s in t[e])s.includes(`${e}/`)&&(t[e][s]=void 0,delete t[e][s]);return t}};m=y([u.Service("StoreModel")],m);const v=(n,t)=>u.get("StoreModel").init(n,t);let _=class{constructor(){this.storeInstance=null,this._name=null,this._reducers=null,this._sliceActions={}}init(t){if(!t.name)throw Error("The slice name cannot be empty and must be set.");if(this.storeInstance.checkSliceName(t.name))throw Error(`The slice with the name '${t.name}' has already been created. The name '${t.name}' for the slice must be uniq, change another name slice.`);if(!/^[a-zA-Z \d.'-_]+$/g.test(t.name))throw Error(`The incorect name '${t.name}'. The name for the slice must be include only latin char, numbers and '-_.' symbols.`);return this._name=t.name,this._reducers=t.reducers,this.storeInstance.setState({[this._name]:a.cloneDeep(t.initState)}),this}get actions(){return this._sliceActions}get name(){return this._name}get state(){return new Proxy(Object.seal(this.storeInstance.getState()[this.name]),{})}get reducer(){for(const t in this._reducers){const e=this._reducers[t].name;if(!e.includes(`${this.name}/${e}`)){const s=`${this.name}/${e}`,r=this._reducers[t].bind(this);a.assign(this._sliceActions,{[s]:i=>(r(this.state,i),{[this.name]:this.state})}),a.assign(this._sliceActions,{[e]:i=>({type:s,payload:i})})}}return this.state}get sliceStore(){return{[this.name]:this.reducer}}};y([u.Inject("StoreModel"),w("design:type",m)],_.prototype,"storeInstance",void 0);_=y([u.Service({id:"SliceModel",transient:!0})],_);function A(n){return u.get("SliceModel").init(n)}const S=Array,E=String,M=Date,g="isArray"in S?S.isArray:n=>toString.call(n)==="[object Array]",j=typeof document<"u"&&typeof document.getElementsByTagName("body")=="function"?n=>!!n&&toString.call(n)==="[object Function]":n=>!!n&&typeof n=="function",I=(n,t)=>n==null||(t?!1:n==="")||g(n)&&n.length===0;exports.ESArray=S;exports.ESDate=M;exports.ESString=E;exports.IsArray=g;exports.IsEmpty=I;exports.IsFunction=j;exports.Store=v;exports.createSlice=A;
