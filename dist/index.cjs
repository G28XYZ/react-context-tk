"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("lodash"),f=require("typedi"),u=require("react");function y(n,t,e,s){var o=arguments.length,i=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,t,e,s);else for(var d=n.length-1;d>=0;d--)(c=n[d])&&(i=(o<3?c(i):o>3?c(t,e,i):c(t,e))||i);return o>3&&i&&Object.defineProperty(t,e,i),i}function I(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function b(n,t,e,s){function o(i){return i instanceof e?i:new e(function(c){c(i)})}return new(e||(e=Promise))(function(i,c){function d(r){try{l(s.next(r))}catch(h){c(h)}}function p(r){try{l(s.throw(r))}catch(h){c(h)}}function l(r){r.done?i(r.value):o(r.value).then(d,p)}l((s=s.apply(n,t||[])).next())})}let _=class{constructor(){this._actions=void 0,this._state=void 0,this._defaultContext={state:this._state,dispatch:()=>({})},this._isInit=!1,this.middlewares=[],this.context=u.createContext(this._defaultContext),this.storeReducer=(t,e)=>(this._state=a.cloneDeep(t),this.onTry(()=>this._actions[e.type.split("/")[0]][e.type](e.payload)),this._state)}init(t,e){if(this._isInit===!1)return this._isInit=!0,this._actions=e,this._state=a.cloneDeep(t),{context:this.context,actions:this.filterAction,instance:this,storeReducer:this.storeReducer}}onTry(t){try{t()}catch(e){console.log(e)}}get proxyState(){return new Proxy(Object.seal(this._state),{})}getState(){return this._state}setState(t){this._state=a.cloneDeep(Object.assign(Object.assign({},this._state),t))}setMiddleware(...t){return this.middlewares=this.middlewares.concat(t)}createMiddleware(...t){return this.setMiddleware(...t.map(e=>({action:e.bind(this)})))}checkSliceName(t){if(this._state)return t in this._state}get filterAction(){const t=a.cloneDeep(this._actions);for(const e in t)for(const s in t[e])s.includes(`${e}/`)&&(t[e][s]=void 0,delete t[e][s]);return t}};_=y([f.Service("StoreModel")],_);var g;let S=class{constructor(){this.storeInstance=null,this._name=null,this._reducers=null,this._sliceActions={}}init(t){if(!t.name)throw Error("The slice name cannot be empty and must be set.");if(this.storeInstance.checkSliceName(t.name))throw Error(`The slice with the name '${t.name}' has already been created. The name '${t.name}' for the slice must be uniq, change another name slice.`);if(!/^[a-zA-Z \d.'-_]+$/g.test(t.name))throw Error(`The incorect name '${t.name}'. The name for the slice must be include only latin char, numbers and '-_.' symbols.`);return this._name=t.name,this._reducers=t.reducers,this.storeInstance.setState({[this._name]:a.cloneDeep(t.initState)}),this}get actions(){return this._sliceActions}get name(){return this._name}get state(){return new Proxy(Object.seal(this.storeInstance.getState()[this.name]),{})}get reducer(){for(const t in this._reducers){const e=this._reducers[t].name;if(!e.includes(`${this.name}/${e}`)){const s=`${this.name}/${e}`,o=this._reducers[t].bind(this);a.assign(this._sliceActions,{[s]:i=>(o(this.state,i),{[this.name]:this.state})}),a.assign(this._sliceActions,{[e]:i=>({type:s,payload:i})})}}return this.state}get sliceStore(){return{[this.name]:this.reducer}}};y([f.Inject("StoreModel"),I("design:type",typeof(g=typeof _<"u"&&_)=="function"?g:Object)],S.prototype,"storeInstance",void 0);S=y([f.Service({id:"SliceModel",transient:!0})],S);function R(n){return f.get("SliceModel").init(n)}let w=class{constructor(){this._actions=void 0,this._state=void 0,this._defaultContext={state:this._state,dispatch:()=>({})},this._isInit=!1,this.middlewares=[],this.context=u.createContext(this._defaultContext),this.storeReducer=(t,e)=>(this._state=a.cloneDeep(t),this.onTry(()=>this._actions[e.type.split("/")[0]][e.type](e.payload)),this._state)}init(t,e){if(this._isInit===!1)return this._isInit=!0,this._actions=e,this._state=a.cloneDeep(t),{context:this.context,actions:this.filterAction,instance:this,storeReducer:this.storeReducer}}onTry(t){try{t()}catch(e){console.log(e)}}get proxyState(){return new Proxy(Object.seal(this._state),{})}getState(){return this._state}setState(t){this._state=a.cloneDeep(Object.assign(Object.assign({},this._state),t))}setMiddleware(...t){return this.middlewares=this.middlewares.concat(t)}createMiddleware(...t){return this.setMiddleware(...t.map(e=>({action:e.bind(this)})))}checkSliceName(t){if(this._state)return t in this._state}get filterAction(){const t=a.cloneDeep(this._actions);for(const e in t)for(const s in t[e])s.includes(`${e}/`)&&(t[e][s]=void 0,delete t[e][s]);return t}};w=y([f.Service("StoreModel")],w);const A=(n,t)=>{const{instance:e,actions:s,context:o,storeReducer:i}=f.get("StoreModel").init(n,t),c=()=>{const[l,r]=u.useReducer(i,e.proxyState),h=m=>b(void 0,void 0,void 0,function*(){const v=e.middlewares;yield Promise.allSettled(v.map(j=>j.action({action:m,state:e.proxyState,actions:s,dispatch:r})).concat({action:()=>b(void 0,void 0,void 0,function*(){return r(m)})}.action()))});return[e.proxyState,h]},d=({children:l})=>{const[r,h]=c(),m=u.useMemo(()=>({state:r,dispatch:h}),[r,h]);return u.createElement(o.Provider,{value:Object.seal(m)},l)};function p(l){const{dispatch:r}=u.useContext(o);return l?[l(e.proxyState),{dispatch:r,actions:s}]:[e.proxyState,{dispatch:r,actions:s}]}return{useStore:p,StoreProvider:d,storeInstance:e}},x=Array,M="isArray"in x?x.isArray:n=>toString.call(n)==="[object Array]",O=typeof document<"u"&&typeof document.getElementsByTagName("body")=="function"?n=>!!n&&toString.call(n)==="[object Function]":n=>!!n&&typeof n=="function",E=(n,t)=>n==null||(t?!1:n==="")||M(n)&&n.length===0,T={array:{IsArray:M},object:{IsEmpty:E,IsFunction:O}};exports.Store=A;exports.Utils=T;exports.createSlice=R;
